when HTTP_REQUEST {
  if {[HTTP::method] eq "POST"} {
    catch {
        foreach aHeader [HTTP::header names] {
            if { [string tolower [HTTP::header $aHeader]] contains "jndi:ldap:" } {
                log local0. "Rejected because header value suspicious to be CVE-2021-44228" 
                reject
            }
        }
    }
    catch {
        if { [string tolower [HTTP::query]] contains "jndi:ldap:" } {
            log local0. "Rejected because payload suspicious to be CVE-2021-44228" 
            reject
        }
    }
    if {[HTTP::header "Content-Length"] ne "" && [HTTP::header "Content-Length"] <= 1048576}{
      set content_length [HTTP::header "Content-Length"]
    } else {
        set content_length 1048576
    }
    if { $content_length > 0} {
      HTTP::collect $content_length
    }
  }
}
when HTTP_REQUEST_DATA {
    catch {
        if { [string tolower [HTTP::payload]] contains "jndi:ldap:" } {
            log local0. "Rejected because payload suspicious to be CVE-2021-44228" 
            reject
        }
    }
    HTTP::release
}